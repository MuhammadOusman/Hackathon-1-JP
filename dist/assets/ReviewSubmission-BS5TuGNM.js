import{j as t,b as Q}from"./mui-BJon3m8q.js";import{a as r}from"./chart-BOdAsdoy.js";import{l as M,i as W,f as X,h as A,j as z,k as H,m as Y,c as _,e as B,n as G}from"./index-Bz2acmnO.js";import{c as C,i as R,b as E,a as F}from"./styles-B615tSB9.js";import{u as K,c as U}from"./react-8-RJajJm.js";import{u as T,e as q}from"./redux-hkUHSYAv.js";const re=()=>{const[a,h]=r.useState([]),[w,c]=r.useState([]),o=JSON.parse(localStorage.getItem("user")),[l,f]=r.useState({}),d=K();r.useEffect(()=>{(async()=>{const[s,u]=await Promise.all([M("products"),M("offers")]);if(h(s),c(u),o&&o.branchId){const m=await W("branches",o.branchId);f(m?.inventory||{})}})()},[]);const S=s=>s,p=s=>{d("/user-dashboard/order",{state:{addItem:{product:s,quantity:1}}})};return t.jsx("div",{children:t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(s=>{const u=l[s.name];if(u===void 0)return null;const m=Number(u)>0,j=m?"bg-emerald-500/15 text-emerald-300 ring-1 ring-emerald-400/30":"bg-red-500/15 text-red-300 ring-1 ring-red-400/30";return t.jsxs("div",{className:`${C} p-0 overflow-hidden group transition transform hover:scale-[1.01] bg-gray-800/60`,children:[t.jsxs("div",{className:"relative",children:[s.image?t.jsx("img",{src:s.image,alt:s.name,className:"w-full h-44 md:h-56 object-cover"}):t.jsx("div",{className:"w-full h-44 md:h-56 bg-gray-700"}),t.jsx("div",{className:"absolute top-3 left-3",children:t.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${j} shadow-sm backdrop-blur`,children:m?`In stock (${u})`:"Out of stock"})})]}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsx("h3",{className:"text-white font-extrabold tracking-tight text-lg md:text-xl line-clamp-2",title:s.name,children:s.name}),t.jsxs("div",{className:"text-blue-300 font-extrabold text-lg md:text-xl whitespace-nowrap",children:["Rs. ",S(s.price)]})]}),s.description?t.jsx("p",{className:"mt-2 text-sm text-gray-300 line-clamp-2",children:s.description}):null,t.jsx("div",{className:"mt-4 flex items-center gap-2",children:t.jsx("button",{onClick:()=>p(s.name),disabled:!m,className:`px-4 py-2 rounded-md font-semibold transition focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-blue-500 ${m?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"Add to order"})})]})]},s.id)})})})},ce=()=>{const a=JSON.parse(localStorage.getItem("user")),[h,w]=r.useState({name:"",contact:"",branchId:a?.branchId||""}),[c,o]=r.useState([]),[l,f]=r.useState({product:"",quantity:1}),[d,S]=r.useState(0),p=U(),s=T(),{branches:u}=q(e=>e.branchReducer),{products:m}=q(e=>e.productReducer),{offers:j}=q(e=>e.offersReducer||{offers:[]}),[i,v]=r.useState({}),{loading:g}=q(e=>e.orderReducer);r.useEffect(()=>{if(s(X()),s(A()),s(z()),a&&a.branchId){const e=(u||[]).find(n=>String(n.id)===String(a.branchId));v(e?.inventory||{})}},[s]),r.useEffect(()=>{if(a&&a.branchId){const e=(u||[]).find(n=>String(n.id)===String(a.branchId));v(e?.inventory||{})}},[u,a?.branchId]),r.useEffect(()=>{const e=p.state&&p.state.addItem;e&&e.product&&(c.some(b=>b.product===e.product)||(o(b=>[...b,{product:e.product,quantity:Number(e.quantity)||1}]),f({product:"",quantity:1})),window.history.replaceState({},document.title))},[p.state]);const k=e=>{w({...h,[e.target.name]:e.target.value})},O=e=>{f({...l,[e.target.name]:e.target.value})},$=e=>{e.preventDefault(),!(!l.product||!l.quantity)&&(o([...c,{...l}]),f({product:"",quantity:1}))},y=e=>{o(c.filter((n,b)=>b!==e))},N=async e=>{if(e.preventDefault(),!h.name.trim()||!h.contact.trim()){alert("Name and contact are required.");return}if(c.length===0){alert("Add at least one item.");return}const n={...h,email:a?.email,items:c,discount:d};await s(H(n)),a&&a.branchId&&await s(Y({id:a.branchId,items:c})),w({name:"",contact:"",branchId:a?.branchId||""}),o([]),S(0),s(A()),s(_()),alert("Order placed!")},I=e=>{const n=m.find(b=>b.name===e);return n?n.price:0},x=r.useMemo(()=>c.reduce((e,n)=>e+I(n.product)*n.quantity,0),[c,m]),J=r.useMemo(()=>d?x-x*d/100:x,[x,d]),P=r.useMemo(()=>j?.find(e=>Number(e.discount)===Number(d)),[j,d]);return t.jsxs("div",{children:[t.jsx("form",{onSubmit:e=>e.preventDefault(),className:`${C} mb-4`,children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsx("input",{name:"name",type:"text",placeholder:"Name",value:h.name,onChange:k,required:!0,className:R}),t.jsx("input",{name:"contact",type:"text",placeholder:"Contact",value:h.contact,onChange:k,required:!0,className:R})]})}),t.jsx("form",{onSubmit:$,className:`${C} mb-6`,children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3 items-center",children:[t.jsxs("select",{name:"product",value:l.product,onChange:O,required:!0,className:`${R} sm:col-span-2`,children:[t.jsx("option",{value:"",children:"Select Product"}),m.map(e=>{const n=i[e.name];if(!n||n<=0)return null;const b=c.filter(D=>D.product===e.name).reduce((D,L)=>D+Number(L.quantity),0);return n-b<=0?null:t.jsxs("option",{value:e.name,children:[e.name," (In Stock)"]},e.id)})]}),t.jsx("input",{name:"quantity",type:"number",min:1,max:l.product?i[l.product]-c.filter(e=>e.product===l.product).reduce((e,n)=>e+Number(n.quantity),0):1,value:l.quantity,onChange:O,required:!0,className:R}),t.jsx("button",{type:"submit",className:E,children:"Add Item"})]})}),c.length>0&&t.jsxs("div",{className:`${C} mb-6`,children:[t.jsx("h3",{className:"text-white font-semibold mb-3",children:"Order Summary"}),t.jsx("ul",{className:"space-y-2",children:c.map((e,n)=>t.jsxs("li",{className:"flex items-center justify-between bg-gray-900/40 border border-white/10 rounded-md p-3",children:[t.jsxs("div",{className:"text-gray-100",children:[e.product," x ",e.quantity]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-blue-300 font-semibold",children:["Rs. ",I(e.product)*e.quantity]}),t.jsx("button",{type:"button",onClick:()=>y(n),className:"p-2 rounded-md bg-red-600 hover:bg-red-700 text-white",title:"Remove",children:t.jsx(Q,{fontSize:"small"})})]})]},n))}),t.jsxs("div",{className:"mt-3 text-gray-300",children:["Subtotal: Rs. ",x]})]}),t.jsx("div",{className:`${C} mb-6`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("label",{htmlFor:"discount",className:"text-gray-200",children:"Discount:"}),t.jsxs("select",{id:"discount",value:d,onChange:e=>S(Number(e.target.value)),className:`${R} w-56 sm:w-64`,children:[t.jsx("option",{value:0,children:"None"}),(j||[]).map(e=>t.jsxs("option",{value:e.discount,children:[e.name," — ",e.discount,"%"]},e.id))]}),P?t.jsxs("span",{className:F,children:[P.name," — ",P.discount,"%"]}):null,t.jsxs("span",{className:F,children:["Total: Rs. ",J]})]})}),t.jsx("form",{onSubmit:N,children:t.jsx("button",{type:"submit",disabled:g||c.length===0,className:E,children:g?"Placing...":"Place Order"})})]})},ie=()=>{const a=T(),{branches:h,loading:w}=q(i=>i.reviewsReducer),c=JSON.parse(localStorage.getItem("user")),[o,l]=r.useState({branchId:c?.branchId||"",review:""}),[f,d]=r.useState(0),[S,p]=r.useState(null),[s,u]=r.useState(!1);r.useEffect(()=>{a(B())},[a]);const m=i=>{l({...o,[i.target.name]:i.target.value})},j=async i=>{i.preventDefault(),u(!0);const v=h.find(g=>g.id===o.branchId);if(v){const g={id:Date.now(),user:c?.name||"Anonymous",email:c?.email||"",review:o.review,rating:f};await a(G({branchId:v.id,review:g})),await a(B()),l({branchId:"",review:""}),d(0),u(!1),alert("Review submitted!")}};return t.jsx("div",{children:t.jsx("form",{onSubmit:j,className:C,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 select-none",children:[t.jsx("span",{className:"text-gray-200",children:"Rating:"}),[1,2,3,4,5].map(i=>{const v=S??f,g=v>=i,k=!g&&v>=i-.5,O=y=>{const N=y.currentTarget.getBoundingClientRect(),I=(y.clientX-N.left)/N.width,x=i-1+(I<.5?.5:1);d(x)},$=y=>{const N=y.currentTarget.getBoundingClientRect(),I=(y.clientX-N.left)/N.width,x=i-1+(I<.5?.5:1);p(x)};return t.jsxs("button",{type:"button",onMouseMove:$,onMouseLeave:()=>p(null),onClick:O,className:"relative text-2xl leading-none w-7 h-7 flex items-center justify-center","aria-label":`Rate ${i} star${i>1?"s":""}`,title:`${i} star${i>1?"s":""}`,children:[t.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-gray-600",children:"★"}),g?t.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400",children:"★"}):k?t.jsx("span",{className:"absolute inset-0 flex items-center justify-center",style:{background:"linear-gradient(90deg, #f59e0b 50%, transparent 50%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",color:"transparent"},children:"★"}):null]},i)})]}),t.jsx("textarea",{name:"review",placeholder:"Your review",value:o.review,onChange:m,required:!0,className:`${R} h-28`}),t.jsx("button",{type:"submit",disabled:s||w||f===0,className:E,children:s||w?"Submitting...":"Submit Review"})]})})})};export{ce as O,re as P,ie as R};
